---
title: "[DU벅이] 화면에 지도 띄우기, 줌, 드래그 구현"                 # 포스팅 이름
excerpt: "지도 앱의 기본 기능 구현"                # 포스팅 간단 설명
typora-root-url: ../                # typora에서 이미지 사용시 images에 자동 저장
categories: dubeogi                 # 카테고리 지정
tag: [flutter, dart]
use_math: true                      # mathjax LaTeX 수식 표현 적용
---

## <span style = 'color: #008000'>지도 이미지 띄우기</span>
지도 제작은 완료했으니 이제 지도를 화면에 띄우기만 하면 된다.  
그냥 지도 이미지를 띄우는 것은 어렵지 않으나 지도 앱의 역할을 하기 위해선<br>
줌, 드래그와 같은 기능을 가지고 있어야 했다. 따라서 위젯 트리를 아래와 같은 순서로 구성했다.

**<span style = 'color: #0000FF'>MaterialApp</span>**: Material Design을 사용할 수 있게 하는 클래스<br>
**<span style = 'color: #0000FF'>Scaffold</span>**: Material Design 구조를 구현하는데 사용되는 위젯<br>
**<span style = 'color: #0000FF'>SafeArea</span>**: 상태표시줄, 노치, 카메라 등이 없는 안전한 영역에만 콘텐츠가 보일 수 있게 해줌<br>
**<span style = 'color: #0000FF'>GestureDetector</span>**: 줌, 드래그와 같은 제스처를 감지하는 위젯<br>
**<span style = 'color: #0000FF'>Transform.scale</span>**: 자식 위젯의 크기를 확대 또는 축소 시켜주는 위젯 (줌)<br>
**<span style = 'color: #0000FF'>Transform.translate</span>**: 자식 위젯의 위치를 이동시켜주는 위젯 (드래그)<br>
**<span style = 'color: #0000FF'>CustomPaint</span>**: 경로를 표시하기 위해 위젯에 선을 그려주는 클래스<br>
**<span style = 'color: #0000FF'>Image.asset</span>**: 지도 이미지

## <span style = 'color: #008000'>줌, 드래그 구현</span>

지도를 확대/축소하고 드래그하기 위해 GestureDetector, Transform.scale, Transform.translate를 이용했다.

### <span style = 'color: #008000'>GestureDetector</span>

GestureDetector 위젯은 사용자의 제스처를 감지한다.  
줌을 했다면 어느 정도 줌을 했는지, 드래그를 했다면 어느 정도 드래그를 했는지 정보를 담아주는 역할을 한다.<br>
지도 이미지 위젯을 줌/드래그 하기 위해서 GestureDetector의 아래에 지도 이미지 위젯을 위치시켰다.<br>
GestureDetector의 콜백함수인 onScaleStart, onScaleUpdate를 이용하여 여러 기능들을 구현하는 것이 가능하다.<br>

### <span style = 'color: #008000'>Transform</span>

Transform은 자식 위젯의 형태, 사이즈, 위치를 변경해주는 위젯이다.  
Transform.scale의 scale 속성의 값을 변경하면 위젯의 크기를 수정 가능하고(**줌 인/줌 아웃**)<br>
Transform.translate의 Offset 속성의 값을 변경하면 위젯의 위치를 변경이 가능하다(**드래그**)<br>

scale 속성의 값과 Offset 속성의 값을 각각 변수로 지정하면 내가 원하는 때에 원하는 만큼 줌/드래그가 가능해진다.

원래 translate의 Offset은 위젯 중심을 기준으로 Offset(0, 0)을 갖는다.  
즉 Offset(50, 0)으로 설정하면 오른쪽으로 50만큼 위젯이 이동하고<br>
Offset(-50, 0)으로 설정하면 왼쪽으로 50만큼 위젯이 이동한다.

하지만 DU벅이는 큰 지도 이미지를 사용하고 대부분 위젯의 크기가 화면에 보여지는 부분의 크기보다 큰 상황(줌)이 많을 것이므로<br>
개발의 편의를 위해 Offset의 중심점을 위젯의 중심이 아닌 이미지의 좌표 기준과 동일하게 좌측상단으로 이동시켰다.<br>
이렇게하면 Offset을 마치 이미지 상의 현재 위치(좌표)처럼 사용이 가능하다.

아래 내용은 중심점을 변환시키는 코드이다.

```dart
Transform.scale(
    scale: mapvalue.scale,
    child: Transform.translate(
        offset: Offset(_imageWidth_du / 2 - mapvalue.position.dx, _imageHeight_du / 2 + bottomSpace / 2 - mapvalue.position.dy).scale(scale_offset, scale_offset)
```

_imageWidth_du는 지도 이미지의 너비이다. 현재 DU벅이는 3000 x 5333 이미지를 사용 중이므로 _imageWidth_du = 3000 이다.  
mapvalue.position.dx는 현재 화면에 보여지는 부분의 중심점 x좌표를 나타낼 변수이다.

